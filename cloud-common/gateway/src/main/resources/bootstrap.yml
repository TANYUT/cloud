server:
  port: 7777



spring:
  application:
    name: gateway
  # 配置中心
  cloud:
    config:
      fail-fast: true
      name: ${spring.application.name}
      profile: dev
      discovery:
        enabled: true
        service-id: config
      #    gateway:
      #      discovery:
      #        locator:
      #          enabled: true
    gateway:
      discovery:
        locator:
          enabled: true
      routes:
        - id: demo
          uri:  lb://demo  #  lb代表从注册中心获取服务 可以负载均衡
          predicates:
            #- Header=demoHeader, \d{6}  # 访问请求头必须要有这个  后面跟的是正则表达
            - Path=/demo/**  #匹配后面的路径
          filters:
            - name: RequestRateLimiter   #filter名称必须是RequestRateLimiter 才能限流
              args:
                redis-rate-limiter.replenishRate: 10 #允许用户每秒处理多少个请求
                redis-rate-limiter.burstCapacity: 20 #令牌桶的容量，允许在一秒钟内完成的最大请求数
                key-resolver: "#{@ipKeyResolver}"  #使用SpEL按名称引用bean
        #            - Retry=5  #  重试5次
#            - StripPrefix=1
        #        # 用户管理
        - id: upms
          uri: lb://upms
          predicates:
            - Path=/upms/**
  profiles:
    active: dev


# 注册中心配置
eureka:
  instance:
    prefer-ip-address: true
  client:
    service-url:
      #      defaultZone: http://cloud:cloud@${CLOUD-EUREKA:localhost}:${EUREKA_PORT:6661}/eureka/
      defaultZone: http://sinotn:sinotn@127.0.0.1:8761/eureka/




#security:
#  encode:
#    # 前端密码密钥，必须16位
#    key: '1234567887654321'

# 不校验验证码终端
ignore:
  clients:
#    - test
#
#logging:
#  level:
#    org.springframework.cloud.gateway: TRACE
#    org.springframework.http.server.reactive: DEBUG
#    org.springframework.web.reactive: DEBUG
#    reactor.ipc.netty: DEBUG




management:
  endpoint:
    gateway:
      enabled: true
  endpoints:
    web:
      exposure:
        include: "*"